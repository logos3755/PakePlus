import{v as L,x as z,y as G,_ as oe,r as h,bi as be,a6 as Z,g as $,bj as ne,o as he,A as l,B as s,E as d,C as B,a3 as Q,a7 as ee,a2 as ge,c as Ie,b9 as Me,a$ as F,ab as le,ac as ye,bk as ke}from"./entry.B79t8160.js";import{I as K}from"./iconify.BCVX6Ifv.js";import{_ as se,N as we,a as Se}from"./Tree.cVHN8enr.js";import{_ as ae,B as P}from"./Button.DLsEGMw6.js";import{u as de}from"./use-message.BH-wgOTP.js";import{_ as xe,a as Ce}from"./FormItem.C3DR4S6Q.js";import{_ as V}from"./Space.CoyloG0X.js";import{_ as re,S as ue}from"./Scrollbar.DfppsR0A.js";import{_ as ie}from"./Card.t-T5tsO1.js";import{_ as ce}from"./Modal.CeSbMG6K.js";const Oe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function De(e,u){return L(),z("svg",Oe,u[0]||(u[0]=[G("path",{fill:"currentColor",d:"m19.352 7.617l-3.96-3.563c-1.127-1.015-1.69-1.523-2.383-1.788L13 5c0 2.357 0 3.536.732 4.268C14.464 10 15.643 10 18 10h3.58c-.362-.704-1.012-1.288-2.228-2.383"},null,-1),G("path",{fill:"currentColor","fill-rule":"evenodd",d:"M14 22h-4c-3.771 0-5.657 0-6.828-1.172C2 19.657 2 17.771 2 14v-4c0-3.771 0-5.657 1.172-6.828C4.343 2 6.239 2 10.03 2c.606 0 1.091 0 1.5.017c-.013.08-.02.161-.02.244l-.01 2.834c0 1.097 0 2.067.105 2.848c.114.847.375 1.694 1.067 2.386c.69.69 1.538.952 2.385 1.066c.781.105 1.751.105 2.848.105h4.052c.043.534.043 1.19.043 2.063V14c0 3.771 0 5.657-1.172 6.828C19.657 22 17.771 22 14 22m3-6c.552 0 1-.672 1-1.5s-.448-1.5-1-1.5s-1 .672-1 1.5s.448 1.5 1 1.5m-8.624 1.084a.75.75 0 0 1 1.04-.208a4.658 4.658 0 0 0 5.168 0a.75.75 0 0 1 .832 1.248a6.158 6.158 0 0 1-6.832 0a.75.75 0 0 1-.208-1.04M7 16c.552 0 1-.672 1-1.5S7.552 13 7 13s-1 .672-1 1.5s.448 1.5 1 1.5","clip-rule":"evenodd"},null,-1)]))}const me={name:"solar-file-smile-bold",render:De},Ee={key:0},je={key:1,class:"grid-empty"},$e={__name:"form",props:{editMode:Boolean,menuID:Number|String,parentId:Number,disabled:{type:Boolean,default:!1}},emits:["update:show","submit"],setup(e,{expose:u,emit:i}){const a=e,f=de(),p=i,S=h(null),k=be("iconTarget"),o=h({menu_name:"",description:"",menu_type:a.parentId==null?"M":"C",parentId:a.parentId||null,visible:"1"}),q={menu_name:{required:!0,message:"请输入组织名称",trigger:"blur"},url:{required:!0,message:"请输入路由的URL",trigger:"blur"}},A=h(!1),w=h(!1),O=async _=>{var r;if(_=="add"){o.value={menu_name:"",url:"",icon:null,menu_type:a.parentId==null?"M":"C",parent_id:a.parentId,visible:"1",description:""};return}w.value=!0;try{const{data:D}=await Q.get(`/menu/${_}`),{status:E,res:R}=D.value;if(E==200){o.value=R;const J=$(K,{icon:o.value.icon||"ri:bnb-line"});ne(J,k.value),f.success(((r=o.value)==null?void 0:r.menu_name)+"读取成功")}else f.error("获取菜单详情失败")}catch{f.error("获取菜单详情异常")}finally{w.value=!1}};return Z(()=>a.menuID,_=>{_&&O(_)},{immediate:!0}),Z(()=>o.value.icon,_=>{if(_!=null){const r=$(K,{icon:_==""?"ri:bnb-line":_});ne(r,k.value)}}),u({handleSubmit:async()=>{var _;await((_=S.value)==null?void 0:_.validate(async r=>{if(!r)try{const D=a.menuID==="add",{data:E}=D?await Q.post("/menu",o.value):await Q.put(`/menu/${a.menuID}`,o.value),{status:R}=E.value;R===200?(A.value=!0,f.success("保存成功")):f.error("保存失败"),p("submit",o.value)}catch{f.error("保存失败，请重试")}}))},formValue:o,menuStatus:A}),he(()=>{}),(_,r)=>{const D=ae,E=xe,R=se,J=V,T=Ce,W=me,H=P,X=re;return e.menuID||e.menuID=="add"?(L(),z("div",Ee,[l(T,{ref_key:"formRef",ref:S,model:d(o),rules:q},{default:s(()=>[l(E,{label:"名称",path:"menu_name"},{default:s(()=>[l(D,{value:d(o).menu_name,"onUpdate:value":r[0]||(r[0]=x=>d(o).menu_name=x),disabled:!e.editMode||e.disabled,placeholder:"请输入组织名称"},null,8,["value","disabled"])]),_:1}),l(E,{label:"路由",path:d(o).menu_type=="C"?"url":"#"},{default:s(()=>[l(D,{value:d(o).url,"onUpdate:value":r[1]||(r[1]=x=>d(o).url=x),disabled:!e.editMode||d(o).menu_type=="M"||e.disabled,placeholder:"请输入组织名称"},null,8,["value","disabled"])]),_:1},8,["path"]),l(E,{label:"图标",path:"icon"},{default:s(()=>[l(D,{value:d(o).icon,"onUpdate:value":r[2]||(r[2]=x=>d(o).icon=x),disabled:!e.editMode||e.disabled,placeholder:"请输入组织名称"},null,8,["value","disabled"]),G("div",{class:"iconTarget text-2xl ml-2",ref_key:"iconTarget",ref:k},null,512)]),_:1}),l(E,{label:"是否是目录",path:"isGroup"},{default:s(()=>[l(J,null,{default:s(()=>[l(R,{round:!1,"checked-value":"M","unchecked-value":"C",disabled:!e.editMode||e.disabled,value:d(o).menu_type,"onUpdate:value":r[3]||(r[3]=x=>d(o).menu_type=x)},{checked:s(()=>r[6]||(r[6]=[B("是")])),unchecked:s(()=>r[7]||(r[7]=[B("否")])),_:1},8,["disabled","value"])]),_:1})]),_:1}),l(E,{label:"是否启用",path:"visible"},{default:s(()=>[l(J,null,{default:s(()=>[l(R,{round:!1,"checked-value":"1","unchecked-value":"0",disabled:!e.editMode||e.disabled,value:d(o).visible,"onUpdate:value":r[4]||(r[4]=x=>d(o).visible=x)},{checked:s(()=>r[8]||(r[8]=[B("是")])),unchecked:s(()=>r[9]||(r[9]=[B("否")])),_:1},8,["disabled","value"])]),_:1})]),_:1}),l(E,{label:"描述",path:"description"},{default:s(()=>[l(D,{value:d(o).description,"onUpdate:value":r[5]||(r[5]=x=>d(o).description=x),disabled:!e.editMode||e.disabled,type:"textarea",placeholder:"请输入组织描述"},null,8,["value","disabled"])]),_:1})]),_:1},8,["model"]),l(J,{justify:"end"})])):(L(),z("div",je,[l(X,{status:"warning",title:"OOPS",description:"请先选择对应目录"},{icon:s(()=>[l(W,{class:"text-6xl"})]),footer:s(()=>[l(H,null,{default:s(()=>r[10]||(r[10]=[B("Task Easy")])),_:1})]),_:1})]))}}},Be=oe($e,[["__scopeId","data-v-ae22ed04"]]),Ne={__name:"modal",props:{show:Boolean,editMode:Boolean,organization:Object,parentId:Number},emits:["update:show","submit"],setup(e,{emit:u}){const i=h(null),a=h(!1),f=u,p=async()=>{a.value=!0;try{await i.value.handleSubmit(),i.value.menuStatus&&(f("submit",i.value.formValue),f("update:show",!1))}catch{}finally{a.value=!1}},S=()=>{a.value||f("update:show",!1)};return(k,o)=>{const q=Be,A=ue,w=P,O=V,v=ie,_=ce;return L(),ee(_,{show:e.show,"onUpdate:show":o[0]||(o[0]=r=>k.$emit("update:show",r)),"mask-closable":!1},{default:s(()=>[l(v,{title:e.parentId==null?"注册目录":"增加目录",style:{width:"600px"}},{footer:s(()=>[l(O,{justify:"end"},{default:s(()=>[l(w,{onClick:S,disabled:a.value},{default:s(()=>o[1]||(o[1]=[B("取 消")])),_:1},8,["disabled"]),l(w,{type:"primary",onClick:p,loading:a.value,disabled:a.value},{default:s(()=>o[2]||(o[2]=[B("创 建")])),_:1},8,["loading","disabled"])]),_:1})]),default:s(()=>[l(A,{style:{"max-height":"100%"},trigger:"hover",class:"w-full"},{default:s(()=>[l(q,{ref_key:"menuForm",ref:i,editMode:e.editMode,menuID:"add",parentId:e.parentId,disabled:a.value},null,8,["editMode","parentId","disabled"])]),_:1})]),_:1},8,["title"])]),_:1},8,["show"])}}},Y=e=>`ra_store_${e}`,Ue=(e,u)=>{try{const i=sessionStorage.getItem(e);return i?JSON.parse(i):u}catch{return u}},Ae=(e,u)=>{try{sessionStorage.setItem(e,JSON.stringify(u))}catch{}},Re=ge("data",{state:()=>({collections:{},currentObject:null}),getters:{getCollection:e=>u=>e.collections[u]||null,getCurrentObject:e=>e.currentObject,getItemById:e=>(u,i)=>(e.collections[u]||{}).find(f=>f.id===i),getAllCollectionTypes:e=>Object.keys(e.collections)},actions:{initCollection(e){const u=Ue(Y(e),null);this.collections[e]||(this.collections[e]=u)},setCurrentObject(e){this.currentObject=e},addItem(e,u){this.collections[e]||(this.collections[e]={});const i={...u,Modules:u.Modules||[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return this.collections[e]=i,this.saveCollection(e),i},updateItem(e,u){const i=this.collections[e];i.Modules=[...u],this.saveCollection(e)},removeItem(e,u){const i=this.collections[e],a=i.findIndex(f=>f.id===u);return a!==-1?(i.splice(a,1),this.saveCollection(e),!0):!1},addSubItem(e,u,i){var f;const a=(f=this.collections[e])==null?void 0:f.find(p=>p.id===u);if(a){a.subItems||(a.subItems=[]);const p={...i,id:i.id||Date.now(),createdAt:new Date().toISOString()};return a.subItems.push(p),this.saveCollection(e),p}return null},removeSubItem(e,u,i){var f;const a=(f=this.collections[e])==null?void 0:f.find(p=>p.id===u);if(a!=null&&a.subItems){const p=a.subItems.findIndex(S=>S.id===i);if(p!==-1)return a.subItems.splice(p,1),this.saveCollection(e),!0}return!1},saveCollection(e){Ae(Y(e),this.collections[e])},clearCollection(e){this.collections[e]&&(this.collections[e]=[],sessionStorage.removeItem(Y(e)))},clearAll(){this.collections={},this.currentObject=null,Object.keys(sessionStorage).forEach(e=>{e.startsWith("app_store_")&&sessionStorage.removeItem(e)})}}}),Le={class:"Module-form w-full"},Pe={class:"mb-2"},Je={key:1,class:"flex w-full"},Ke={class:"flex w-full h-full justify-center items-center"},qe={key:2,class:"Module-auth"},ze={__name:"tree",props:{normal:{type:Boolean,default:!1},rangeCheckable:{type:Boolean,default:!1},relateObject:{type:Object,default:null}},emits:["isEditMode","getModuleKey","ModuleChecked","selectModules"],setup(e,{emit:u}){Re();const i=e,a=de();h({});const f=h([]),p=h(!1),S=h(!1),k=h(!1);h(null);const o=h(null),q=h(null),A=h(""),w=h(!1),O=u,v=h([]),_=h([]),r=Ie(()=>{const n=t=>v.value.filter(m=>m.parentId===t).sort((m,M)=>m.orderId-M.orderId).map(m=>{const M={key:m.id,label:m.menu_name,orderId:m.orderId,menuType:m.menu_type,description:m.description,prefix:()=>$(K,{icon:t==null?"solar:list-up-minimalistic-bold-duotone":"solar:hamburger-menu-broken"})},C=n(m.id);return C.length>0&&(M.children=C),M});return n(null)}),D=()=>{try{Q.get("/menu").then(({data:n,refresh:t})=>{const{status:c,error:m,res:M}=n.value;v.value=M;const C=v.value.filter(g=>g.parentId===null);_.value=C.map(g=>g.id),t()})}catch{}finally{}},E=({option:n})=>$("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},[$("span",{class:"tree-module-name w-full",title:n.menu_name,onClick:()=>w.value?H(n):X(n)},n.label),w.value?$(V,{class:"tree-module-actions"},{default:()=>[$(P,{size:"tiny",onClick:t=>{t.stopPropagation(),W(n)}},{default:()=>$(K,{icon:"ri:add-large-fill"})}),$(P,{size:"tiny",onClick:t=>{t.stopPropagation(),x(n)}},{default:()=>$(K,{icon:"ri:delete-bin-6-line"})})]}):null]),R=(n,t,c=["dataRange","authRange"])=>{var C;const m=new Set(t),M=((C=i.relateObject)==null?void 0:C.Modules)||[];return n.value.filter(g=>m.has(g.id)).map(g=>{var I;const b=M.find(j=>j.id===g.id);if(b){const j={...g};return c.forEach(N=>{b[N]!==void 0&&(j[N]=JSON.parse(JSON.stringify(b[N])))}),j}const y=(I=n.value)==null?void 0:I.find(j=>j.id===g.id);if(!y)return g;const U={...g};return c.forEach(j=>{y[j]!==void 0&&(U[j]=JSON.parse(JSON.stringify(y[j])))}),U})},J=n=>{const t=R(v,n);f.value=n,i.relateObject.Modules=t,O("ModuleChecked",t),O("selectModules",n)},T=(n,t,c)=>{if(c.node)switch(c.action){case"expand":c.node.prefix=()=>$(K,{icon:"solar:list-up-minimalistic-bold-duotone"});break;case"collapse":c.node.prefix=()=>$(K,{icon:"solar:list-arrow-down-outline"});break}},W=n=>{n?(o.value=n.key,S.value=!0):(o.value=null,p.value=!0)},H=n=>{O("getModuleKey",n.key)},X=n=>{const t=document.querySelectorAll(".item-active");t&&t.forEach(m=>{m.classList.remove("item-active")});const c=document.querySelector(`.item-${n.key}`);c&&(c.scrollIntoView({behavior:"smooth",block:"start"}),c.classList.add("item-active")),O("getModuleKey",n.key)},x=n=>{q.value=n.key,k.value=!0},te=n=>{const t={id:v.value.length>0?Math.max(...v.value.map(c=>c.id))+1:1,...n,parentId:o.value,orderId:v.value.filter(c=>c.parentId===o.value).length};v.value.push(t),p.value=!1,S.value=!1,a.success("组织创建成功")},fe=()=>{const n=t=>{v.value=v.value.filter(m=>m.id!==t),v.value.filter(m=>m.parentId===t).forEach(m=>n(m.id))};n(q.value),k.value=!1,a.success("组织删除成功")},pe=n=>{const t=document.querySelectorAll(".tree-module-name");n?(t.forEach(c=>{c.classList.add("edit")}),O("isEditMode",!0)):(t.forEach(c=>{c.classList.remove("edit")}),p.value=!1,S.value=!1,k.value=!1,O("isEditMode",!1))},ve=({node:n,dragNode:t,dropPosition:c})=>{if(!w.value)return;const m=t.key,M=n.key,C=v.value.find(b=>b.id===m),g=v.value.find(b=>b.id===M);try{if(c==="inside")C.parentId=M,C.orderId=t.orderId,v.value.filter(y=>y.parentId===M).forEach((y,U)=>{y.orderId=U});else{C.parentId=g.parentId;const b=v.value.filter(N=>N.parentId===g.parentId);let y;const U=b.findIndex(N=>N.id==M),I=b.findIndex(N=>N.id==m);c==="after"?y=parseInt(U)+1:y=U;const[j]=b.splice(I,1);b.splice(y,0,j),b.forEach((N,_e)=>{N.orderId=_e})}v.value.sort((b,y)=>b.orderId-y.orderId),a.success("组织结构更新成功")}catch{a.error("组织结构更新失败")}};return Me(()=>{D(),O("ModuleChecked",[])}),Z(()=>i.relateObject,n=>{n.hasOwnProperty("Modules")||(n.Modules=[]),f.value=n.hasOwnProperty("selectedModules")?n.selectedModules:[],O("ModuleChecked",R(v,f.value))}),(n,t)=>{const c=se,m=ae,M=Se,C=ue,g=ie,b=me,y=re,U=Ne;return L(),z("div",Le,[e.relateObject||e.normal?(L(),ee(g,{key:0,class:ye(["Module-tree",{normal:e.normal}])},{default:s(()=>[G("div",Pe,[l(d(V),{class:"tree-actions"},{default:s(()=>[l(c,{value:d(w),"onUpdate:value":[t[0]||(t[0]=I=>F(w)?w.value=I:null),pe]},null,8,["value"]),d(w)?(L(),ee(d(P),{key:0,onClick:t[1]||(t[1]=I=>W())},{default:s(()=>t[7]||(t[7]=[B("注册目录")])),_:1})):le("",!0)]),_:1}),l(M,{"trigger-top":50,position:"absolute","listen-to":n.containerRef},{default:s(()=>[l(m,{value:d(A),"onUpdate:value":t[2]||(t[2]=I=>F(A)?A.value=I:null),placeholder:"搜索",clearable:""},null,8,["value"])]),_:1},8,["listen-to"])]),l(C,{trigger:"hover",class:"w-full relative"},{default:s(()=>[l(d(we),{data:d(r),"show-irrelevant-nodes":!1,"render-label":E,pattern:d(A),"default-expanded-keys":d(_),draggable:"","expand-on-click":"",checkable:d(w)||e.rangeCheckable,"checked-keys":d(f),"on-update:expanded-keys":T,"show-line":"",cascade:"","onUpdate:checkedKeys":J,onDrop:ve},null,8,["data","pattern","default-expanded-keys","checkable","checked-keys"])]),_:1})]),_:1},8,["class"])):(L(),z("div",Je,[l(g,null,{default:s(()=>[G("div",Ke,[l(y,{status:"warning",title:"OOPS",description:"请先选择对应角色"},{icon:s(()=>[l(b,{class:"text-6xl"})]),footer:s(()=>[l(d(P),null,{default:s(()=>t[8]||(t[8]=[B("Task Easy")])),_:1})]),_:1})])]),_:1})])),l(U,{show:d(p),"onUpdate:show":t[3]||(t[3]=I=>F(p)?p.value=I:null),"edit-mode":!0,"parent-id":null,onSubmit:te},null,8,["show"]),l(U,{show:d(S),"onUpdate:show":t[4]||(t[4]=I=>F(S)?S.value=I:null),"edit-mode":!0,"parent-id":d(o),onSubmit:te},null,8,["show","parent-id"]),l(d(ce),{show:d(k),"onUpdate:show":t[6]||(t[6]=I=>F(k)?k.value=I:null),preset:"dialog",title:"确认删除"},{content:s(()=>t[9]||(t[9]=[B("确定要删除该组织吗？此操作将删除该组织及其所有子组织。")])),action:s(()=>[l(d(P),{onClick:t[5]||(t[5]=I=>k.value=!1)},{default:s(()=>t[10]||(t[10]=[B("取消")])),_:1}),l(d(P),{type:"error",onClick:fe},{default:s(()=>t[11]||(t[11]=[B("确认删除")])),_:1})]),_:1},8,["show"]),e.normal?le("",!0):(L(),z("div",qe,[l(d(V),null,{default:s(()=>[ke(n.$slots,"default",{},void 0,!0)]),_:3})]))])}}},et=oe(ze,[["__scopeId","data-v-af950ea4"]]);export{me as _,et as a,Be as b,Re as r};
