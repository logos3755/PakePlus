import{u as Qe,B as j,_ as Se,a as We,c as _e}from"./Button.DLsEGMw6.js";import{d as oe,g as p,O as Xe,P as fe,b2 as Ye,b3 as Ze,r as x,b4 as xe,U as et,R as ue,c as D,F as q,I as se,J as N,H as Oe,G as tt,Q as $e,K as lt,b5 as rt,b6 as le,b7 as nt,M as at,b8 as ot,a6 as pe,v as F,a7 as W,B as a,A as r,C as $,z as Z,_ as ve,b9 as st,x as V,E as R,a$ as H,ab as ce,a8 as ne,a3 as ke,o as Ce,ba as it,y as A,a9 as ie,ac as ye,aa as dt}from"./entry.B79t8160.js";import{_ as ut,a as ct}from"./FormItem.C3DR4S6Q.js";import{_ as Re,N as ft}from"./Tree.cVHN8enr.js";import{_ as ae}from"./Space.CoyloG0X.js";import{_ as we}from"./Card.t-T5tsO1.js";import{_ as ge}from"./Modal.CeSbMG6K.js";import{I as re}from"./iconify.BCVX6Ifv.js";import{u as Fe}from"./use-message.BH-wgOTP.js";import{g as pt,_ as vt,a as gt}from"./Tabs.CgZEd0ml.js";import{_ as ht}from"./Checkbox.BnzM6f0E.js";import{N as mt,V as bt}from"./Empty.Dpu5cBr_.js";import{u as _t}from"./use-merged-state.Dyf7G0SV.js";import{_ as yt,r as xt,a as kt}from"./tree.B3YHNUVY.js";import{_ as St}from"./file-copy2-fill.DB8EAPjP.js";import{_ as Ae}from"./tree.IKo0Z6do.js";import{S as Ct,_ as Rt}from"./Scrollbar.DfppsR0A.js";import{N as Ue}from"./Tag.ehYFDh3x.js";import{_ as wt}from"./loading.DIF8ReVX.js";import{_ as Ot,a as Tt}from"./Grid.DwqS4h9-.js";import{_ as It}from"./Layout.BrvNxXSP.js";import"./use-compitable.BTv5PzVL.js";const Mt=oe({name:"Search",render(){return p("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",style:"enable-background: new 0 0 512 512"},p("path",{d:`M443.5,420.2L336.7,312.4c20.9-26.2,33.5-59.4,33.5-95.5c0-84.5-68.5-153-153.1-153S64,132.5,64,217s68.5,153,153.1,153
  c36.6,0,70.1-12.8,96.5-34.2l106.1,107.1c3.2,3.4,7.6,5.1,11.9,5.1c4.1,0,8.2-1.5,11.3-4.5C449.5,437.2,449.7,426.8,443.5,420.2z
   M217.1,337.1c-32.1,0-62.3-12.5-85-35.2c-22.7-22.7-35.2-52.9-35.2-84.9c0-32.1,12.5-62.3,35.2-84.9c22.7-22.7,52.9-35.2,85-35.2
  c32.1,0,62.3,12.5,85,35.2c22.7,22.7,35.2,52.9,35.2,84.9c0,32.1-12.5,62.3-35.2,84.9C279.4,324.6,249.2,337.1,217.1,337.1z`}))}}),de=Xe("n-transfer"),Te=oe({name:"TransferHeader",props:{size:{type:String,required:!0},selectAllText:String,clearText:String,source:Boolean,onCheckedAll:Function,onClearAll:Function,title:[String,Function]},setup(t){const{targetOptionsRef:c,canNotSelectAnythingRef:i,canBeClearedRef:b,allCheckedRef:v,mergedThemeRef:d,disabledRef:f,mergedClsPrefixRef:u,srcOptionsLengthRef:m}=fe(de),{localeRef:_}=Qe("Transfer");return()=>{const{source:w,onClearAll:g,onCheckedAll:z,selectAllText:y,clearText:E}=t,{value:C}=d,{value:S}=u,{value:T}=_,U=t.size==="large"?"small":"tiny",{title:h}=t;return p("div",{class:`${S}-transfer-list-header`},h&&p("div",{class:`${S}-transfer-list-header__title`},typeof h=="function"?h():h),w&&p(j,{class:`${S}-transfer-list-header__button`,theme:C.peers.Button,themeOverrides:C.peerOverrides.Button,size:U,tertiary:!0,onClick:v.value?g:z,disabled:i.value||f.value},{default:()=>v.value?E||T.unselectAll:y||T.selectAll}),!w&&b.value&&p(j,{class:`${S}-transfer-list-header__button`,theme:C.peers.Button,themeOverrides:C.peerOverrides.Button,size:U,tertiary:!0,onClick:g,disabled:f.value},{default:()=>T.clearAll}),p("div",{class:`${S}-transfer-list-header__extra`},w?T.total(m.value):T.selected(c.value.length)))}}}),Ie=oe({name:"NTransferListItem",props:{source:Boolean,label:{type:String,required:!0},value:{type:[String,Number],required:!0},disabled:Boolean,option:{type:Object,required:!0}},setup(t){const{targetValueSetRef:c,mergedClsPrefixRef:i,mergedThemeRef:b,handleItemCheck:v,renderSourceLabelRef:d,renderTargetLabelRef:f,showSelectedRef:u}=fe(de),m=Ye(()=>c.value.has(t.value));function _(){t.disabled||v(!m.value,t.value)}return{mergedClsPrefix:i,mergedTheme:b,checked:m,showSelected:u,renderSourceLabel:d,renderTargetLabel:f,handleClick:_}},render(){const{disabled:t,mergedTheme:c,mergedClsPrefix:i,label:b,checked:v,source:d,renderSourceLabel:f,renderTargetLabel:u}=this;return p("div",{class:[`${i}-transfer-list-item`,t&&`${i}-transfer-list-item--disabled`,d?`${i}-transfer-list-item--source`:`${i}-transfer-list-item--target`],onClick:d?this.handleClick:void 0},p("div",{class:`${i}-transfer-list-item__background`}),d&&this.showSelected&&p("div",{class:`${i}-transfer-list-item__checkbox`},p(ht,{theme:c.peers.Checkbox,themeOverrides:c.peerOverrides.Checkbox,disabled:t,checked:v})),p("div",{class:`${i}-transfer-list-item__label`,title:pt(b)},d?f?f({option:this.option}):b:u?u({option:this.option}):b),!d&&!t&&p(Ze,{focusable:!1,class:`${i}-transfer-list-item__close`,clsPrefix:i,onClick:this.handleClick}))}}),Me=oe({name:"TransferList",props:{virtualScroll:{type:Boolean,required:!0},itemSize:{type:Number,required:!0},options:{type:Array,required:!0},disabled:{type:Boolean,required:!0},source:Boolean},setup(){const{mergedThemeRef:t,mergedClsPrefixRef:c}=fe(de),i=x(null),b=x(null);function v(){var u;(u=i.value)===null||u===void 0||u.sync()}function d(){const{value:u}=b;if(!u)return null;const{listElRef:m}=u;return m}function f(){const{value:u}=b;if(!u)return null;const{itemsElRef:m}=u;return m}return{mergedTheme:t,mergedClsPrefix:c,scrollerInstRef:i,vlInstRef:b,syncVLScroller:v,scrollContainer:d,scrollContent:f}},render(){const{mergedTheme:t,options:c}=this;if(c.length===0)return p(mt,{theme:t.peers.Empty,themeOverrides:t.peerOverrides.Empty});const{mergedClsPrefix:i,virtualScroll:b,source:v,disabled:d,syncVLScroller:f}=this;return p(xe,{ref:"scrollerInstRef",theme:t.peers.Scrollbar,themeOverrides:t.peerOverrides.Scrollbar,container:b?this.scrollContainer:void 0,content:b?this.scrollContent:void 0},{default:()=>b?p(bt,{ref:"vlInstRef",style:{height:"100%"},class:`${i}-transfer-list-content`,items:this.options,itemSize:this.itemSize,showScrollbar:!1,onResize:f,onScroll:f,keyField:"value"},{default:({item:u})=>{const{source:m,disabled:_}=this;return p(Ie,{source:m,key:u.value,value:u.value,disabled:u.disabled||_,label:u.label,option:u})}}):p("div",{class:`${i}-transfer-list-content`},c.map(u=>p(Ie,{source:v,key:u.value,value:u.value,disabled:u.disabled||d,label:u.label,option:u})))})}}),ze=oe({name:"TransferFilter",props:{value:String,placeholder:String,disabled:Boolean,onUpdateValue:{type:Function,required:!0}},setup(){const{mergedThemeRef:t,mergedClsPrefixRef:c}=fe(de);return{mergedClsPrefix:c,mergedTheme:t}},render(){const{mergedTheme:t,mergedClsPrefix:c}=this;return p("div",{class:`${c}-transfer-filter`},p(Se,{value:this.value,onUpdateValue:this.onUpdateValue,disabled:this.disabled,placeholder:this.placeholder,theme:t.peers.Input,themeOverrides:t.peerOverrides.Input,clearable:!0,size:"small"},{"clear-icon-placeholder":()=>p(et,{clsPrefix:c},{default:()=>p(Mt,null)})}))}});function zt(t){const c=x(t.defaultValue),i=_t(ue(t,"value"),c),b=D(()=>{const e=new Map;return(t.options||[]).forEach(s=>e.set(s.value,s)),e}),v=D(()=>new Set(i.value||[])),d=D(()=>{const e=b.value,s=[];return(i.value||[]).forEach(M=>{const P=e.get(M);P&&s.push(P)}),s}),f=x(""),u=x(""),m=D(()=>t.sourceFilterable||!!t.filterable),_=D(()=>{const{showSelected:e,options:s,filter:M}=t;return m.value?s.filter(P=>M(f.value,P,"source")&&(e||!v.value.has(P.value))):e?s:s.filter(P=>!v.value.has(P.value))}),w=D(()=>{if(!t.targetFilterable)return d.value;const{filter:e}=t;return d.value.filter(s=>e(u.value,s,"target"))}),g=D(()=>{const{value:e}=i;return e===null?new Set:new Set(e)}),z=D(()=>{const e=new Set(g.value);return _.value.forEach(s=>{!s.disabled&&!e.has(s.value)&&e.add(s.value)}),e}),y=D(()=>{const e=new Set(g.value);return _.value.forEach(s=>{!s.disabled&&e.has(s.value)&&e.delete(s.value)}),e}),E=D(()=>{const e=new Set(g.value);return w.value.forEach(s=>{s.disabled||e.delete(s.value)}),e}),C=D(()=>_.value.every(e=>e.disabled)),S=D(()=>{if(!_.value.length)return!1;const e=g.value;return _.value.every(s=>s.disabled||e.has(s.value))}),T=D(()=>w.value.some(e=>!e.disabled));function U(e){f.value=e??""}function h(e){u.value=e??""}return{uncontrolledValueRef:c,mergedValueRef:i,targetValueSetRef:v,valueSetForCheckAllRef:z,valueSetForUncheckAllRef:y,valueSetForClearRef:E,filteredTgtOptionsRef:w,filteredSrcOptionsRef:_,targetOptionsRef:d,canNotSelectAnythingRef:C,canBeClearedRef:T,allCheckedRef:S,srcPatternRef:f,tgtPatternRef:u,mergedSrcFilterableRef:m,handleSrcFilterUpdateValue:U,handleTgtFilterUpdateValue:h}}const $t=q("transfer",`
 width: 100%;
 font-size: var(--n-font-size);
 height: 300px;
 display: flex;
 flex-wrap: nowrap;
 word-break: break-word;
`,[se("disabled",[q("transfer-list",[q("transfer-list-header",[N("title",`
 color: var(--n-header-text-color-disabled);
 `),N("extra",`
 color: var(--n-header-extra-text-color-disabled);
 `)])])]),q("transfer-list",`
 flex: 1;
 min-width: 0;
 height: inherit;
 display: flex;
 flex-direction: column;
 background-clip: padding-box;
 position: relative;
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-list-color);
 `,[se("source",`
 border-top-left-radius: var(--n-border-radius);
 border-bottom-left-radius: var(--n-border-radius);
 `,[N("border","border-right: 1px solid var(--n-divider-color);")]),se("target",`
 border-top-right-radius: var(--n-border-radius);
 border-bottom-right-radius: var(--n-border-radius);
 `,[N("border","border-left: none;")]),N("border",`
 padding: 0 12px;
 border: 1px solid var(--n-border-color);
 transition: border-color .3s var(--n-bezier);
 pointer-events: none;
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 `),q("transfer-list-header",`
 min-height: var(--n-header-height);
 box-sizing: border-box;
 display: flex;
 padding: 12px 12px 10px 12px;
 align-items: center;
 background-clip: padding-box;
 border-radius: inherit;
 border-bottom-left-radius: 0;
 border-bottom-right-radius: 0;
 line-height: 1.5;
 transition:
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `,[Oe("> *:not(:first-child)",`
 margin-left: 8px;
 `),N("title",`
 flex: 1;
 min-width: 0;
 line-height: 1.5;
 font-size: var(--n-header-font-size);
 font-weight: var(--n-header-font-weight);
 transition: color .3s var(--n-bezier);
 color: var(--n-header-text-color);
 `),N("button",`
 position: relative;
 `),N("extra",`
 transition: color .3s var(--n-bezier);
 font-size: var(--n-extra-font-size);
 margin-right: 0;
 white-space: nowrap;
 color: var(--n-header-extra-text-color);
 `)]),q("transfer-list-body",`
 flex-basis: 0;
 flex-grow: 1;
 box-sizing: border-box;
 position: relative;
 display: flex;
 flex-direction: column;
 border-radius: inherit;
 border-top-left-radius: 0;
 border-top-right-radius: 0;
 `,[q("transfer-filter",`
 padding: 4px 12px 8px 12px;
 box-sizing: border-box;
 transition:
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `),q("transfer-list-flex-container",`
 flex: 1;
 position: relative;
 `,[q("scrollbar",`
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 height: unset;
 `),q("empty",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateY(-50%) translateX(-50%);
 `),q("transfer-list-content",`
 padding: 0;
 margin: 0;
 position: relative;
 `,[q("transfer-list-item",`
 padding: 0 12px;
 min-height: var(--n-item-height);
 display: flex;
 align-items: center;
 color: var(--n-item-text-color);
 position: relative;
 transition: color .3s var(--n-bezier);
 `,[N("background",`
 position: absolute;
 left: 4px;
 right: 4px;
 top: 0;
 bottom: 0;
 border-radius: var(--n-border-radius);
 transition: background-color .3s var(--n-bezier);
 `),N("checkbox",`
 position: relative;
 margin-right: 8px;
 `),N("close",`
 opacity: 0;
 pointer-events: none;
 position: relative;
 transition:
 opacity .3s var(--n-bezier),
 background-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
 `),N("label",`
 position: relative;
 min-width: 0;
 flex-grow: 1;
 `),se("source","cursor: pointer;"),se("disabled",`
 cursor: not-allowed;
 color: var(--n-item-text-color-disabled);
 `),tt("disabled",[Oe("&:hover",[N("background","background-color: var(--n-item-color-pending);"),N("close",`
 opacity: 1;
 pointer-events: all;
 `)])])])])])])])]),Ft=Object.assign(Object.assign({},$e.props),{value:Array,defaultValue:{type:Array,default:null},options:{type:Array,default:()=>[]},disabled:{type:Boolean,default:void 0},virtualScroll:Boolean,sourceTitle:[String,Function],selectAllText:String,clearText:String,targetTitle:[String,Function],filterable:{type:Boolean,default:void 0},sourceFilterable:Boolean,targetFilterable:Boolean,showSelected:{type:Boolean,default:!0},sourceFilterPlaceholder:String,targetFilterPlaceholder:String,filter:{type:Function,default:(t,c)=>t?~`${c.label}`.toLowerCase().indexOf(`${t}`.toLowerCase()):!0},size:String,renderSourceLabel:Function,renderTargetLabel:Function,renderSourceList:Function,renderTargetList:Function,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),At=oe({name:"Transfer",props:Ft,setup(t){const{mergedClsPrefixRef:c}=lt(t),i=$e("Transfer","-transfer",$t,rt,t,c),b=We(t),{mergedSizeRef:v,mergedDisabledRef:d}=b,f=D(()=>{const{value:l}=v,{self:{[le("itemHeight",l)]:n}}=i.value;return nt(n)}),{uncontrolledValueRef:u,mergedValueRef:m,targetValueSetRef:_,valueSetForCheckAllRef:w,valueSetForUncheckAllRef:g,valueSetForClearRef:z,filteredTgtOptionsRef:y,filteredSrcOptionsRef:E,targetOptionsRef:C,canNotSelectAnythingRef:S,canBeClearedRef:T,allCheckedRef:U,srcPatternRef:h,tgtPatternRef:e,mergedSrcFilterableRef:s,handleSrcFilterUpdateValue:M,handleTgtFilterUpdateValue:P}=zt(t);function B(l){const{onUpdateValue:n,"onUpdate:value":k,onChange:I}=t,{nTriggerFormInput:O,nTriggerFormChange:ee}=b;n&&_e(n,l),k&&_e(k,l),I&&_e(I,l),u.value=l,O(),ee()}function G(){B([...w.value])}function X(){B([...g.value])}function Y(){B([...z.value])}function Q(l,n){B(l?(m.value||[]).concat(n):(m.value||[]).filter(k=>k!==n))}function o(l){B(l)}return at(de,{targetValueSetRef:_,mergedClsPrefixRef:c,disabledRef:d,mergedThemeRef:i,targetOptionsRef:C,canNotSelectAnythingRef:S,canBeClearedRef:T,allCheckedRef:U,srcOptionsLengthRef:D(()=>t.options.length),handleItemCheck:Q,renderSourceLabelRef:ue(t,"renderSourceLabel"),renderTargetLabelRef:ue(t,"renderTargetLabel"),showSelectedRef:ue(t,"showSelected")}),{mergedClsPrefix:c,mergedDisabled:d,itemSize:f,isMounted:ot(),mergedTheme:i,filteredSrcOpts:E,filteredTgtOpts:y,srcPattern:h,tgtPattern:e,mergedSize:v,mergedSrcFilterable:s,handleSrcFilterUpdateValue:M,handleTgtFilterUpdateValue:P,handleSourceCheckAll:G,handleSourceUncheckAll:X,handleTargetClearAll:Y,handleItemCheck:Q,handleChecked:o,cssVars:D(()=>{const{value:l}=v,{common:{cubicBezierEaseInOut:n},self:{borderRadius:k,borderColor:I,listColor:O,titleTextColor:ee,titleTextColorDisabled:L,extraTextColor:K,itemTextColor:te,itemColorPending:he,itemTextColorDisabled:me,titleFontWeight:J,closeColorHover:be,closeColorPressed:Pe,closeIconColor:Ee,closeIconColorHover:De,closeIconColorPressed:Be,closeIconSize:Le,closeSize:Ne,dividerColor:Ve,extraTextColorDisabled:je,[le("extraFontSize",l)]:qe,[le("fontSize",l)]:Ke,[le("titleFontSize",l)]:Je,[le("itemHeight",l)]:He,[le("headerHeight",l)]:Ge}}=i.value;return{"--n-bezier":n,"--n-border-color":I,"--n-border-radius":k,"--n-extra-font-size":qe,"--n-font-size":Ke,"--n-header-font-size":Je,"--n-header-extra-text-color":K,"--n-header-extra-text-color-disabled":je,"--n-header-font-weight":J,"--n-header-text-color":ee,"--n-header-text-color-disabled":L,"--n-item-color-pending":he,"--n-item-height":He,"--n-item-text-color":te,"--n-item-text-color-disabled":me,"--n-list-color":O,"--n-header-height":Ge,"--n-close-size":Ne,"--n-close-icon-size":Le,"--n-close-color-hover":be,"--n-close-color-pressed":Pe,"--n-close-icon-color":Ee,"--n-close-icon-color-hover":De,"--n-close-icon-color-pressed":Be,"--n-divider-color":Ve}})}},render(){const{mergedClsPrefix:t,renderSourceList:c,renderTargetList:i,mergedTheme:b,mergedSrcFilterable:v,targetFilterable:d}=this;return p("div",{class:[`${t}-transfer`,this.mergedDisabled&&`${t}-transfer--disabled`],style:this.cssVars},p("div",{class:`${t}-transfer-list ${t}-transfer-list--source`},p(Te,{source:!0,selectAllText:this.selectAllText,clearText:this.clearText,title:this.sourceTitle,onCheckedAll:this.handleSourceCheckAll,onClearAll:this.handleSourceUncheckAll,size:this.mergedSize}),p("div",{class:`${t}-transfer-list-body`},v?p(ze,{onUpdateValue:this.handleSrcFilterUpdateValue,value:this.srcPattern,disabled:this.mergedDisabled,placeholder:this.sourceFilterPlaceholder}):null,p("div",{class:`${t}-transfer-list-flex-container`},c?p(xe,{theme:b.peers.Scrollbar,themeOverrides:b.peerOverrides.Scrollbar},{default:()=>c({onCheck:this.handleChecked,checkedOptions:this.filteredTgtOpts,pattern:this.srcPattern})}):p(Me,{source:!0,options:this.filteredSrcOpts,disabled:this.mergedDisabled,virtualScroll:this.virtualScroll,itemSize:this.itemSize}))),p("div",{class:`${t}-transfer-list__border`})),p("div",{class:`${t}-transfer-list ${t}-transfer-list--target`},p(Te,{onClearAll:this.handleTargetClearAll,size:this.mergedSize,title:this.targetTitle}),p("div",{class:`${t}-transfer-list-body`},d?p(ze,{onUpdateValue:this.handleTgtFilterUpdateValue,value:this.tgtPattern,disabled:this.mergedDisabled,placeholder:this.sourceFilterPlaceholder}):null,p("div",{class:`${t}-transfer-list-flex-container`},i?p(xe,{theme:b.peers.Scrollbar,themeOverrides:b.peerOverrides.Scrollbar},{default:()=>i({onCheck:this.handleChecked,checkedOptions:this.filteredTgtOpts,pattern:this.tgtPattern})}):p(Me,{options:this.filteredTgtOpts,disabled:this.mergedDisabled,virtualScroll:this.virtualScroll,itemSize:this.itemSize}))),p("div",{class:`${t}-transfer-list__border`})))}}),Ut={__name:"modal",props:{show:Boolean,editMode:Boolean,roleInfo:Object,parentId:String||Number},emits:["update:show","submit"],setup(t,{emit:c}){const i=t,b=c,v=x(null),d=x(!1),f=x({label:"",description:"",parentId:null}),u={label:{required:!0,message:"请输入组织名称",trigger:"blur"},description:{required:!0,message:"请输入组织描述",trigger:"blur"}};pe(()=>i.show,w=>{w&&(i.editMode&&i.roleInfo?f.value={...i.roleInfo}:f.value={label:"",description:"",parentId:i.parentId||null})},{immediate:!0});const m=w=>{var g;w.preventDefault(),(g=v.value)==null||g.validate(z=>{if(!z){d.value=!0;try{b("submit",f.value)}catch{}}})},_=()=>{d.value||b("update:show",!1)};return(w,g)=>{const z=Se,y=ut,E=Re,C=ae,S=ct,T=j,U=we,h=ge;return F(),W(h,{show:t.show,"onUpdate:show":g[4]||(g[4]=e=>w.$emit("update:show",e)),"mask-closable":!1},{default:a(()=>[r(U,{title:t.editMode?"编辑组织":"创建组织",style:{width:"600px"}},{footer:a(()=>[r(C,{justify:"end"},{default:a(()=>[r(T,{onClick:_,disabled:d.value},{default:a(()=>g[9]||(g[9]=[$("取消")])),_:1},8,["disabled"]),r(T,{type:"primary",onClick:m,loading:d.value,disabled:d.value},{default:a(()=>[$(Z(t.editMode?"更新":"创建"),1)]),_:1},8,["loading","disabled"])]),_:1})]),default:a(()=>[r(S,{ref_key:"formRef",ref:v,model:f.value,rules:u},{default:a(()=>[r(y,{label:"名称",path:"label"},{default:a(()=>[r(z,{value:f.value.label,"onUpdate:value":g[0]||(g[0]=e=>f.value.label=e),placeholder:"请输入组织名称",disabled:d.value},null,8,["value","disabled"])]),_:1}),r(y,{label:"是否是群组",path:"isGroup"},{default:a(()=>[r(C,null,{default:a(()=>[r(E,{round:!1,"checked-value":1,"unchecked-value":0,disabled:"",value:f.value.isgroup,"onUpdate:value":g[1]||(g[1]=e=>f.value.isgroup=e)},{checked:a(()=>g[5]||(g[5]=[$(" 是 ")])),unchecked:a(()=>g[6]||(g[6]=[$(" 否 ")])),_:1},8,["value"])]),_:1})]),_:1}),r(y,{label:"是否启用",path:"isGroup"},{default:a(()=>[r(C,null,{default:a(()=>[r(E,{round:!1,"checked-value":1,"unchecked-value":0,value:f.value.status,"onUpdate:value":g[2]||(g[2]=e=>f.value.status=e),disabled:d.value},{checked:a(()=>g[7]||(g[7]=[$(" 是 ")])),unchecked:a(()=>g[8]||(g[8]=[$(" 否 ")])),_:1},8,["value","disabled"])]),_:1})]),_:1}),r(y,{label:"描述",path:"description"},{default:a(()=>[r(z,{value:f.value.description,"onUpdate:value":g[3]||(g[3]=e=>f.value.description=e),type:"textarea",placeholder:"请输入组织描述",disabled:d.value},null,8,["value","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])]),_:1},8,["show"])}}},Pt={__name:"tree",props:{rangeCheckable:{type:Boolean,default:!1},roleType:{type:String,default:"sys"}},emits:["isEditMode","getRoleKey","roleChecked","clearId"],setup(t,{emit:c}){const i=Fe(),b=x(!1),v=x(!1),d=x(!1),f=x(!1),u=x(null),m=x(null),_=x(null),w=x(""),g=x(!1),z=c,y=x([]),E=x([]),C=D(()=>{const o=l=>y.value.filter(k=>k.parentId===l).sort((k,I)=>k.orderId-I.orderId).map(k=>{const I={key:k.id,label:k.label,orderId:k.orderId,isgroup:k.role_isgroup,description:k.description,status:k.status,prefix:()=>p(re,{icon:l==null?"solar:user-broken":"solar:user-check-bold"})},O=o(k.id);return O.length>0&&(I.children=O),I});return o(null)}),S=({option:o})=>p("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},onClick:()=>M(o)},[p("span",{class:"tree-role-name w-full",title:o.label},o.label),g.value?p(ae,{class:"tree-role-actions"},{default:()=>[o.isgroup==1?p(j,{size:"tiny",onClick:l=>{l.stopPropagation(),e(o)}},{default:()=>p(re,{icon:"ri:add-large-fill"})}):null,p(j,{size:"tiny",onClick:l=>{l.stopPropagation(),s(o)}},{default:()=>p(re,{icon:"ri:edit-2-fill"})}),p(j,{size:"tiny",onClick:l=>{l.stopPropagation(),P(o)}},{default:()=>p(re,{icon:"ri:delete-bin-6-line"})})]}):null]),T=async()=>{try{await ke.get("/role").then(({data:o})=>{const{status:l,error:n,res:k}=o.value;y.value=k;const I=y.value.filter(O=>O.parentId===null);E.value=I.map(O=>O.id)})}catch{}finally{}},U=o=>{z("roleChecked",o)},h=(o,l,n)=>{if(n.node)switch(n.action){case"expand":n.node.prefix=()=>p(re,{icon:"solar:user-broken"});break;case"collapse":n.node.prefix=()=>p(re,{icon:"solar:user-check-bold"});break}},e=o=>{m.value=o.key,v.value=!0},s=o=>{g.value&&(z("getRoleKey",o),u.value=o,d.value=!0)},M=o=>{z("getRoleKey",o)},P=o=>{_.value=o.key,f.value=!0},B=o=>{const l={id:y.value.length>0?Math.max(...y.value.map(n=>n.id))+1:1,...o,parentId:m.value,orderId:y.value.filter(n=>n.parentId===m.value).length};y.value.push(l),b.value=!1,i.success("组织创建成功")},G=o=>{const l=y.value.findIndex(n=>n.id===o.id);l!==-1&&(y.value[l]={...y.value[l],...o}),d.value=!1,i.success("组织更新成功")},X=()=>{const o=l=>{y.value=y.value.filter(k=>k.id!==l),y.value.filter(k=>k.parentId===l).forEach(k=>o(k.id))};o(_.value),f.value=!1,i.success("组织删除成功")},Y=o=>{const l=document.querySelectorAll(".tree-role-name");o?(l.forEach(n=>{n.classList.add("edit")}),z("isEditMode",!0)):(l.forEach(n=>{n.classList.remove("edit")}),b.value=!1,d.value=!1,f.value=!1,z("isEditMode",!1))},Q=({node:o,dragNode:l,dropPosition:n})=>{if(!g.value)return;const k=l.key,I=o.key,O=y.value.find(L=>L.id===k),ee=y.value.find(L=>L.id===I);try{if(n==="inside")O.parentId=I,O.orderId=l.orderId,y.value.filter(K=>K.parentId===I).forEach((K,te)=>{K.orderId=te});else{O.parentId=ee.parentId;const L=y.value.filter(J=>J.parentId===ee.parentId);let K;const te=L.findIndex(J=>J.id==I),he=L.findIndex(J=>J.id==k);n==="after"?K=parseInt(te)+1:K=te;const[me]=L.splice(he,1);L.splice(K,0,me),L.forEach((J,be)=>{J.orderId=be})}y.value.sort((L,K)=>L.orderId-K.orderId),i.success("组织结构更新成功")}catch{i.error("组织结构更新失败")}};return st(()=>{T()}),(o,l)=>{const n=Re,k=Se,I=Ut;return F(),V(ne,null,[r(R(ae),{vertical:"",class:"w-full"},{default:a(()=>[r(R(ae),{class:"tree-actions"},{default:a(()=>[r(n,{value:R(g),"onUpdate:value":[l[0]||(l[0]=O=>H(g)?g.value=O:null),Y]},null,8,["value"]),R(g)?(F(),W(R(j),{key:0,onClick:l[1]||(l[1]=O=>b.value=!0)},{default:a(()=>l[8]||(l[8]=[$("创建角色组")])),_:1})):ce("",!0)]),_:1}),r(k,{value:R(w),"onUpdate:value":l[2]||(l[2]=O=>H(w)?w.value=O:null),placeholder:"搜索",clearable:""},null,8,["value"]),r(R(ft),{data:R(C),"show-irrelevant-nodes":!1,"render-label":S,pattern:R(w),"default-expanded-keys":R(E),draggable:"","expand-on-click":"",checkable:R(g)||t.rangeCheckable,"onUpdate:checkedKeys":U,onDrop:Q,"on-update:expanded-keys":h,"show-line":"",cascade:""},null,8,["data","pattern","default-expanded-keys","checkable"])]),_:1}),r(I,{show:R(b),"onUpdate:show":l[3]||(l[3]=O=>H(b)?b.value=O:null),"edit-mode":!1,onSubmit:B},null,8,["show"]),r(I,{show:R(v),"onUpdate:show":l[4]||(l[4]=O=>H(v)?v.value=O:null),"edit-mode":!1,"parent-id":R(m),onSubmit:B},null,8,["show","parent-id"]),r(I,{show:R(d),"onUpdate:show":l[5]||(l[5]=O=>H(d)?d.value=O:null),"edit-mode":!0,roleInfo:R(u),onSubmit:G},null,8,["show","roleInfo"]),r(R(ge),{show:R(f),"onUpdate:show":l[7]||(l[7]=O=>H(f)?f.value=O:null),preset:"dialog",title:"确认删除"},{content:a(()=>l[9]||(l[9]=[$("确定要删除该组织吗？此操作将删除该组织及其所有子组织。")])),action:a(()=>[r(R(j),{onClick:l[6]||(l[6]=O=>f.value=!1)},{default:a(()=>l[10]||(l[10]=[$("取消")])),_:1}),r(R(j),{type:"error",onClick:X},{default:a(()=>l[11]||(l[11]=[$("确认删除")])),_:1})]),_:1},8,["show"])],64)}}},Et=ve(Pt,[["__scopeId","data-v-77a294ca"]]),Dt={class:"flex mt-5 justify-end"},Bt={__name:"copyDialog",props:{sourceData:{required:!0,default:()=>null},selectedModules:{required:!0,default:()=>null},show:{required:!0,default:()=>!1}},emits:["update:show"],setup(t,{emit:c}){const i=Fe(),b=c,v=t,d=x([]),f=D(()=>v.selectedModules.filter(_=>_.id!=v.sourceData.id).map(_=>({value:_.id,label:_.menu_name}))),u=()=>{if(d.value.length===0){i.warning("请先勾选要粘贴权限的对象");return}try{v.selectedModules.forEach(m=>{let _=v.sourceData;d.value.includes(m.id)&&(m.authRange=JSON.parse(JSON.stringify(_.authRange)),m.dataRange=JSON.parse(JSON.stringify(_.dataRange)))})}catch(m){i.warning(`复制异常${m}`);return}finally{i.success("复制成功"),b("update:show",!1)}};return pe(()=>v.show,m=>{m||(d.value=[])}),Ce(()=>{}),it(()=>{}),(m,_)=>{const w=At,g=ae,z=j,y=ge;return F(),W(y,{show:t.show,"onUpdate:show":_[1]||(_[1]=E=>m.$emit("update:show",E)),"mask-closable":!1,preset:"dialog",title:"复制权限"},{default:a(()=>[r(g,{vertical:""},{default:a(()=>[r(w,{value:R(d),"onUpdate:value":_[0]||(_[0]=E=>H(d)?d.value=E:null),"virtual-scroll":"",options:R(f),"source-filterable":"","target-filterable":""},null,8,["value","options"])]),_:1}),A("nav",Dt,[r(z,{ghost:"",size:"small",onClick:u},{default:a(()=>_[2]||(_[2]=[$("粘贴权限")])),_:1})])]),_:1},8,["show"])}}},Lt={class:"flex justify-end gap-2 mt-5"},Nt={__name:"orgSelectDialog",props:{show:{type:Boolean,required:!0,default:!1},defaultCheckedKeys:{type:Array,default:()=>[]}},emits:["update:show","confirm"],setup(t,{emit:c}){const i=t,b=c,v=x([]);Ce(()=>{v.value=i.defaultCheckedKeys||[]}),pe(()=>i.defaultCheckedKeys,u=>{u?v.value=[...u]:v.value=[]},{immediate:!0,deep:!0});const d=u=>{v.value=u},f=()=>{b("confirm",v.value),b("update:show",!1)};return(u,m)=>{const _=Ct,w=we,g=j,z=ge;return F(),W(z,{show:t.show,"onUpdate:show":m[1]||(m[1]=y=>u.$emit("update:show",y)),"mask-closable":!1,preset:"dialog",title:"选择组织范围"},{default:a(()=>[r(w,null,{default:a(()=>[r(_,{style:{"max-height":"500px"},trigger:"hover",class:"w-full"},{default:a(()=>[r(Ae,{"range-checkable":!0,"checked-keys":v.value,onOrgChecked:d},null,8,["checked-keys"])]),_:1})]),_:1}),A("nav",Lt,[r(g,{onClick:m[0]||(m[0]=y=>u.$emit("update:show",!1))},{default:a(()=>m[2]||(m[2]=[$("取消")])),_:1}),r(g,{type:"primary",onClick:f},{default:a(()=>m[3]||(m[3]=[$("确认")])),_:1})])]),_:1},8,["show"])}}},Vt=ve(Nt,[["__scopeId","data-v-b6e1189a"]]),jt=["onMousedown"],qt={class:"item-header"},Kt={class:"text-lg"},Jt={class:"item-content"},Ht={class:"flex items-center justify-between mb-2"},Gt={key:0},Qt={class:"item-content"},Wt={class:"flex items-center justify-between mb-2"},Xt={key:1,class:"grid-empty"},Yt={__name:"authGrid",props:{relateObject:{required:!0,default:()=>null}},emits:["update:relateObject"],setup(t,{emit:c}){const i=x(null),b=t,v=x(!1),d=x(!1),f=x({}),u=x(null),m=x([]),_=x([]);x(!1);const w=()=>[{label:"本人",value:"own",type:!0},{label:"本组织 ",value:"ownDep",type:!1},{label:"本组织及以下",value:"ownDeps",type:!1},{label:"自定义数据",value:"custom",type:!1},{label:"全部数据",value:"all",type:!1}],g=()=>[{label:"查看",value:"view",type:!0},{label:"创建",value:"create",type:!1},{label:"修改",value:"update",type:!1},{label:"删除",value:"delete",type:!1},{label:"导出",value:"export",type:!1},{label:"导入",value:"import",type:!1}],z=c,y=(h,e,s)=>{s=="data"?h.value!="custom"?e.dataRange.forEach(M=>{h.value=="all"&&h.type&&M.value!="all"||M.value!=h.value&&M.value!="custom"?M.type=!1:M.value=="custom"&&h.type&&(M.children=[])}):e.dataRange.forEach(M=>{M.value=="all"&&(M.type=!1)}):s=="auth"&&(e.authRange.every(P=>P.type)?e.all=!0:e.all=!1)},E=h=>{let e=h.authRange.every(s=>s.type);e?h.authRange.forEach(s=>{s.type=!1}):h.authRange.forEach(s=>{s.type=!0}),e?h.all=!1:h.all=!0},C=h=>{const e=document.querySelectorAll(".item-active");e&&e.forEach(M=>{M.classList.remove("item-active")});const s=document.querySelector(`.item-${h.id}`);s&&s.classList.add("item-active")},S=h=>{let e=JSON.parse(JSON.stringify(h.dataRange)),s=JSON.parse(JSON.stringify(h.authRange));f.value={id:h.id,dataRange:e,authRange:s},v.value=!0},T=h=>{u.value=h,_.value=h.dataRange[3].children||[],d.value=!0},U=h=>{u.value&&(u.value.dataRange[3].children=h)};return pe(()=>b.relateObject,h=>{h&&(h.Modules.forEach(e=>{e.dataRange.length==0&&(e.dataRange=w()),e.authRange.length==0&&(e.authRange=g())}),z("update:relateObject",h))},{deep:!0}),(h,e)=>{const s=ae,M=St,P=j,B=Ue,G=Re,X=Bt,Y=yt,Q=Rt;return t.relateObject&&t.relateObject.Modules.length>0?(F(),V("div",{key:0,ref_key:"containerRef",ref:i,class:ye(`grid-${t.relateObject.Modules.length==1?"simple-":""}container`)},[(F(!0),V(ne,null,ie(t.relateObject.Modules,(o,l)=>(F(),V("div",{class:ye(`card item-${o.id}`),key:l,onMousedown:dt(n=>C(o),["stop"])},[A("div",qt,[r(s,{vertical:"",class:"item-label pl-2"},{default:a(()=>[A("p",Kt,Z(o.menu_name),1),A("small",null,Z(o.description),1)]),_:2},1024),r(s,{class:"p-2"},{default:a(()=>[r(P,{size:"tiny",ghost:"",title:"复制权限",onClick:n=>S(o)},{default:a(()=>[r(M)]),_:2},1032,["onClick"])]),_:2},1024)]),e[5]||(e[5]=A("div",{class:"item-line mt-1 mb-1"},null,-1)),A("div",{class:ye(`item-${t.relateObject.Modules.length==1?"simple-":""}contents`)},[A("div",Jt,[A("div",Ht,[A("h2",null,[r(B,{bordered:!1,type:"warning"},{default:a(()=>e[2]||(e[2]=[$("数据范围")])),_:1})]),o.dataRange[3].type==!0?(F(),V("div",Gt,[r(P,{ghost:"",type:"warning",size:"small",onClick:n=>T(o)},{default:a(()=>e[3]||(e[3]=[$("设置自定义范围")])),_:2},1032,["onClick"])])):ce("",!0)]),r(s,{vertical:"",class:"item-rang"},{default:a(()=>[(F(!0),V(ne,null,ie(o.dataRange,(n,k)=>(F(),V("div",{key:k,class:"item-datarang flex justify-between"},[$(Z(n.label)+" ",1),r(G,{round:!1,value:n.type,"onUpdate:value":[I=>n.type=I,I=>y(n,o,"data")]},null,8,["value","onUpdate:value"])]))),128))]),_:2},1024)]),A("div",Qt,[A("div",Wt,[A("h2",null,[r(B,{bordered:!1,type:"info"},{default:a(()=>e[4]||(e[4]=[$("权限范围")])),_:1})]),A("div",null,[r(P,{ghost:"",type:"info",size:"small",onClick:n=>E(o)},{default:a(()=>[$(Z(o.all?"取消":"")+"全选",1)]),_:2},1032,["onClick"])])]),r(s,{vertical:"",class:"item-rang"},{default:a(()=>[(F(!0),V(ne,null,ie(o.authRange,(n,k)=>(F(),V("div",{key:k,class:"item-datarang flex justify-between"},[$(Z(n.label)+" ",1),r(G,{round:!1,value:n.type,"onUpdate:value":[I=>n.type=I,I=>y(n,o,"auth")]},null,8,["value","onUpdate:value"])]))),128))]),_:2},1024)])],2)],42,jt))),128)),r(X,{selectedModules:t.relateObject.Modules,sourceData:f.value,show:v.value,"onUpdate:show":e[0]||(e[0]=o=>v.value=o)},null,8,["selectedModules","sourceData","show"]),r(Vt,{show:d.value,"onUpdate:show":e[1]||(e[1]=o=>d.value=o),orgData:m.value,defaultCheckedKeys:_.value,onConfirm:U},null,8,["show","orgData","defaultCheckedKeys"])],2)):(F(),V("div",Xt,[r(Q,{status:"warning",title:"OOPS",description:"请先选择对应模块"},{icon:a(()=>[r(Y,{class:"text-6xl"})]),footer:a(()=>[r(P,null,{default:a(()=>e[6]||(e[6]=[$("Task Easy")])),_:1})]),_:1})]))}}},Zt=ve(Yt,[["__scopeId","data-v-a0c37379"]]),el={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function tl(t,c){return F(),V("svg",el,c[0]||(c[0]=[A("g",{fill:"none",stroke:"currentColor","stroke-width":"1.5"},[A("path",{d:"M3.464 20.536C4.93 22 7.286 22 12 22c4.714 0 7.071 0 8.535-1.465C22 19.072 22 16.714 22 12c0-.341 0-.512-.015-.686a4.042 4.042 0 0 0-.921-2.224a8.285 8.285 0 0 0-.483-.504l-5.167-5.167a8.448 8.448 0 0 0-.504-.483a4.043 4.043 0 0 0-2.224-.92C12.512 2 12.342 2 12 2C7.286 2 4.929 2 3.464 3.464C2 4.93 2 7.286 2 12c0 4.714 0 7.071 1.464 8.535Z"}),A("path",{d:"M17 22v-1c0-1.886 0-2.828-.586-3.414C15.828 17 14.886 17 13 17h-2c-1.886 0-2.828 0-3.414.586C7 18.172 7 19.114 7 21v1"}),A("path",{"stroke-linecap":"round",d:"M7 8h6",opacity:".5"})],-1)]))}const ll={name:"solar-diskette-line-duotone",render:tl},rl={key:0,class:"component-context p-12"},nl={class:"role-container h-full"},al={class:"about"},ol={class:"absolute top-0 right-0 px-7 pt-5"},sl={__name:"roleManage",setup(t){xt();const c=x(null),i=x([]),b=x([]),v=x("resourceTree"),d=x("sys"),f=x([{value:"resourceTree",label:"资源权限"}]),u=x([{value:"sys",label:"系统角色"},{value:"org",label:"组织角色"}]),m=async C=>{try{const S=await ke.get(`/role/${C.key}`),{data:T,refresh:U}=S,{status:h,error:e,res:s}=T.value;s&&(c.value={...C,selectedModules:s.selectedModules||[],Modules:s.Modules||[]},s.selectedModules&&(i.value=s.selectedModules))}catch{}},_=C=>{b.value=C,C.length>1?(v.value="resourceTree",f.value.findIndex(T=>T.value==="roleForm")>-1&&f.value.splice(0,1)):(f.value.findIndex(T=>T.value==="roleForm")==-1&&f.value.splice(0,0,{value:"roleForm",label:"角色信息"}),v.value="roleForm")},w=C=>{i.value=C},g=C=>{if(c.value){let S=()=>{const T=C.filter(h=>h.menu_type!="M"),U=c.value.Modules||[];return T.map(h=>{const e=U.find(s=>s.id===h.id);return e?{...JSON.parse(JSON.stringify(h)),dataRange:e.dataRange||[],authRange:e.authRange||[]}:JSON.parse(JSON.stringify(h))})};c.value.Modules=S()}},z=()=>{ke.post("/role",{currentRole:c.value.key,selectModules:i.value,modules:c.value.Modules}).then(({res:C,refresh:S})=>{S()})},y=C=>{c.value=C},E=()=>{c.value=null};return Ce(()=>{}),(C,S)=>{const T=Et,U=we,h=vt,e=gt,s=Ot,M=Zt,P=kt,B=Ae,G=Ue,X=Tt,Y=ll,Q=j,o=It,l=wt;return F(),V("div",rl,[r(o,{class:"flow-content h-full","native-scrollbar":!1},{default:a(()=>[A("div",nl,[r(U,{title:"权限管理",class:"role-management"},{default:a(()=>[r(X,{cols:24,"x-gap":12,class:"role-management-grid relative"},{default:a(()=>[r(s,{span:6,class:"role-management-column relative"},{default:a(()=>[r(U,{class:"role-card"},{default:a(()=>[r(e,{value:R(d),"onUpdate:value":S[0]||(S[0]=n=>H(d)?d.value=n:null),type:"segment","tab-style":"min-width: 80px;",class:"role-tabs"},{default:a(()=>[(F(!0),V(ne,null,ie(R(u),n=>(F(),W(h,{key:n.value,name:n.value,tab:n.label,class:"roleInfo-tab-panel"},{default:a(()=>[r(U,{class:"relative"},{default:a(()=>[r(T,{roleType:n.value,onGetRoleKey:m,onRoleChecked:_,onClearId:E},null,8,["roleType"])]),_:2},1024)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),r(s,{span:18,class:"role-management-column relative"},{default:a(()=>[r(U,{class:"role-card flex"},{default:a(()=>[r(e,{value:R(v),"onUpdate:value":S[1]||(S[1]=n=>H(v)?v.value=n:null),type:"card","tab-style":"min-width: 80px;",class:"role-tabs"},{suffix:a(()=>[A("div",al,[S[2]||(S[2]=$(" 当前： ")),r(G,{round:"",type:"warning",bordered:!1},{default:a(()=>[$(Z(R(c)?R(c).label:"未选择"),1)]),_:1})])]),default:a(()=>[(F(!0),V(ne,null,ie(R(f),n=>(F(),W(h,{key:n.value,name:n.value,tab:n.label,class:"roleInfo-tab-panel"},{default:a(()=>[n.value==="resourceTree"?(F(),W(P,{key:0,rangeCheckable:!0,relateObject:R(c),normal:!1,onModuleChecked:g,onSelectModules:w},{default:a(()=>[r(M,{relateObject:R(c),"onUpdate:relateObject":y},null,8,["relateObject"])]),_:1},8,["relateObject"])):ce("",!0),n.value==="orgRangeTree"?(F(),W(B,{key:1,rangeCheckable:!0,class:"role-panel"})):ce("",!0)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),A("div",ol,[r(Q,{type:"success",size:"small",onClick:z},{icon:a(()=>[r(Y)]),default:a(()=>[S[3]||(S[3]=$(" 保存 "))]),_:1})])]),_:1})])]),_:1}),r(l,{loading:"加载中..."})])}}},Ml=ve(sl,[["__scopeId","data-v-3ffaa1b3"]]);export{Ml as default};
